{"ast":null,"code":"var _jsxFileName = \"/Users/marshall/Desktop/epic-react/epic/src/components/Uploader.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef } from 'react';\nimport { useStores } from '../stores';\nimport { observer, useLocalStore } from 'mobx-react';\nimport { InboxOutlined } from '@ant-design/icons';\nimport { Upload, message, Spin } from 'antd';\nimport styled from 'styled-components';\nimport image from '../stores/image';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Dragger\n} = Upload;\nconst Result = styled.div`\n  margin-top: 30px;\n  border: 1px dashed #ccc;\n  padding: 20px;\n`;\n_c = Result;\nconst H1 = styled.h1`\n  margin: 20px 0;\n  text-align: center;\n`;\n_c2 = H1;\nconst Image = styled.img`\n  max-width: 300px;\n`;\n_c3 = Image;\nconst Component = observer(_c4 = _s(() => {\n  _s();\n\n  const {\n    ImageStore,\n    UserStore\n  } = useStores();\n  const ref1 = useRef(),\n        ref2 = useRef(); // 返回值要加个括号，不然会被理解为函数体\n\n  const store = useLocalStore(() => ({\n    width: null,\n    height: null,\n\n    get widthStr() {\n      return store.width ? `/w/${store.width}` : '';\n    },\n\n    get heightStr() {\n      return store.height ? `/h/${store.height}` : '';\n    },\n\n    get fullStr() {\n      return ImageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr;\n    },\n\n    setHeight(height) {\n      store.height = height;\n    },\n\n    setWidth(width) {\n      store.width = width;\n    }\n\n  }));\n\n  const bindWidthChange = () => {\n    store.setWidth(ref1.current.value);\n  };\n\n  const bindHeightChange = () => {\n    store.setHeight(ref2.current.value);\n  };\n\n  const props = {\n    showUploadList: false,\n    beforeUpload: file => {\n      ImageStore.setFile(file);\n      ImageStore.setFilename(file.name);\n\n      if (UserStore.currentUser == null) {\n        message.warning('请先登陆再上传');\n        return false;\n      } // 可以在控制台看到文件的api\n\n\n      window.file = file; // .ig是指忽略大小写\n\n      if (!/(svg$)|(png$)|(jpg$)|(jpeg$)|(gif$)/ig.test(file.type)) {\n        message.error('只能上传.png/.gif/.jpg/.svg格式的图片');\n        return false;\n      }\n\n      if (file.size > 1024 * 1024) {\n        message.error('最大上传1M图片');\n        return false;\n      }\n\n      ImageStore.upload().then(serverFile => {\n        console.log('上传成功');\n      }).catch(() => console.log('上传失败'));\n      return false;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Spin, {\n      tip: \"\\u4E0A\\u4F20\\u4E2D\",\n      spinning: ImageStore.isUploading,\n      children: /*#__PURE__*/_jsxDEV(Dragger, { ...props,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ant-upload-drag-icon\",\n          children: /*#__PURE__*/_jsxDEV(InboxOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ant-upload-text\",\n          children: \"\\u70B9\\u51FB\\u6216\\u8005\\u62D6\\u62FD\\u4E0A\\u4F20\\u56FE\\u7247\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ant-upload-hint\",\n          children: \"\\u4EC5\\u652F\\u6301.png/.gif/.jpg/.svg\\u683C\\u5F0F\\u7684\\u56FE\\u7247\\uFF0C\\u56FE\\u7247\\u6700\\u59271M\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }, this), ImageStore.serverFile ? /*#__PURE__*/_jsxDEV(Result, {\n      children: [/*#__PURE__*/_jsxDEV(H1, {\n        children: \"\\u4E0A\\u4F20\\u7ED3\\u679C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"dl\", {\n        children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n          children: \"\\u7EBF\\u4E0A\\u5730\\u5740\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n          children: /*#__PURE__*/_jsxDEV(\"a\", {\n            target: \"_blank\",\n            href: ImageStore.serverFile.attributes.url.attributes.url,\n            children: ImageStore.serverFile.attributes.url.attributes.url\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dt\", {\n          children: \"\\u6587\\u4EF6\\u540D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n          children: ImageStore.filename\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dt\", {\n          children: \"\\u56FE\\u7247\\u9884\\u89C8\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n          children: /*#__PURE__*/_jsxDEV(Image, {\n            src: ImageStore.serverFile.attributes.url.attributes.url\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dt\", {\n          children: \"\\u66F4\\u591A\\u5C3A\\u5BF8\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            ref: ref1,\n            onChange: bindWidthChange,\n            placeholder: \"\\u6700\\u5927\\u5BBD\\u5EA6\\uFF08\\u53EF\\u9009\\uFF09\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: ref2,\n            onChange: bindHeightChange,\n            placeholder: \"\\u6700\\u5927\\u9AD8\\u5EA6\\uFF08\\u53EF\\u9009\\uFF09\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n          children: /*#__PURE__*/_jsxDEV(\"a\", {\n            target: \"_blank\",\n            href: store.fullStr,\n            children: store.fullStr\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 7\n  }, this);\n}, \"W8kATBhixGiR0wcnzJAqStD6rMY=\", false, function () {\n  return [useStores, useLocalStore];\n}));\n_c5 = Component;\nexport default Component;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"Result\");\n$RefreshReg$(_c2, \"H1\");\n$RefreshReg$(_c3, \"Image\");\n$RefreshReg$(_c4, \"Component$observer\");\n$RefreshReg$(_c5, \"Component\");","map":{"version":3,"sources":["/Users/marshall/Desktop/epic-react/epic/src/components/Uploader.js"],"names":["React","useRef","useStores","observer","useLocalStore","InboxOutlined","Upload","message","Spin","styled","image","Dragger","Result","div","H1","h1","Image","img","Component","ImageStore","UserStore","ref1","ref2","store","width","height","widthStr","heightStr","fullStr","serverFile","attributes","url","setHeight","setWidth","bindWidthChange","current","value","bindHeightChange","props","showUploadList","beforeUpload","file","setFile","setFilename","name","currentUser","warning","window","test","type","error","size","upload","then","console","log","catch","isUploading","filename"],"mappings":"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","sourcesContent":["import React, {useRef} from 'react'\nimport {useStores} from '../stores'\nimport {observer, useLocalStore} from 'mobx-react'\nimport {InboxOutlined} from '@ant-design/icons'\nimport {Upload, message, Spin} from 'antd'\nimport styled from 'styled-components'\nimport image from '../stores/image'\n\nconst {Dragger} = Upload\n\nconst Result = styled.div`\n  margin-top: 30px;\n  border: 1px dashed #ccc;\n  padding: 20px;\n`\nconst H1 = styled.h1`\n  margin: 20px 0;\n  text-align: center;\n`\nconst Image = styled.img`\n  max-width: 300px;\n`\n\n\nconst Component = observer(() => {\n    const {ImageStore, UserStore} = useStores()\n    const ref1 = useRef(), ref2 = useRef()\n    // 返回值要加个括号，不然会被理解为函数体\n    const store = useLocalStore(() => ({\n      width: null,\n      height: null,\n      get widthStr() {\n        return store.width ? `/w/${store.width}` : ''\n      },\n      get heightStr() {\n        return store.height ? `/h/${store.height}` : ''\n      },\n      get fullStr() {\n        return ImageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr\n      },\n      setHeight(height) {\n        store.height = height\n      },\n      setWidth(width) {\n        store.width = width\n      },\n    }))\n\n    const bindWidthChange = () => {\n      store.setWidth(ref1.current.value)\n    }\n    const bindHeightChange = () => {\n      store.setHeight(ref2.current.value)\n    }\n    const props = {\n      showUploadList: false,\n      beforeUpload: file => {\n        ImageStore.setFile(file)\n        ImageStore.setFilename(file.name)\n        if (UserStore.currentUser == null) {\n          message.warning('请先登陆再上传')\n          return false\n        }\n        // 可以在控制台看到文件的api\n        window.file = file\n\n        // .ig是指忽略大小写\n        if (!/(svg$)|(png$)|(jpg$)|(jpeg$)|(gif$)/ig.test(file.type)) {\n          message.error('只能上传.png/.gif/.jpg/.svg格式的图片')\n          return false\n        }\n        if (file.size > 1024 * 1024) {\n          message.error('最大上传1M图片')\n          return false\n        }\n        ImageStore.upload()\n          .then((serverFile) => {\n              console.log('上传成功')\n            }\n          ).catch(() => console.log('上传失败'))\n        return false\n      }\n    }\n\n    return (\n      <div>\n        <Spin tip='上传中' spinning={ImageStore.isUploading}>\n          <Dragger {...props}>\n            <p className=\"ant-upload-drag-icon\">\n              <InboxOutlined/>\n            </p>\n            <p className=\"ant-upload-text\">点击或者拖拽上传图片</p>\n            <p className=\"ant-upload-hint\">\n              仅支持.png/.gif/.jpg/.svg格式的图片，图片最大1M\n            </p>\n          </Dragger>\n        </Spin>\n        {\n          ImageStore.serverFile ?\n            <Result>\n              <H1>上传结果</H1>\n              <dl>\n                <dt>线上地址</dt>\n                <dd><a target=\"_blank\"\n                       href={ImageStore.serverFile.attributes.url.attributes.url}>{ImageStore.serverFile.attributes.url.attributes.url}</a>\n                </dd>\n                <dt>文件名</dt>\n                <dd>{ImageStore.filename}</dd>\n                <dt>图片预览</dt>\n                <dd>\n                  <Image src={ImageStore.serverFile.attributes.url.attributes.url}/>\n                </dd>\n                <dt>更多尺寸</dt>\n                <dd>\n                  <input ref={ref1} onChange={bindWidthChange} placeholder=\"最大宽度（可选）\"/>\n                  <input ref={ref2} onChange={bindHeightChange} placeholder=\"最大高度（可选）\"/>\n                </dd>\n                <dd>\n                  <a target=\"_blank\" href={store.fullStr}>{store.fullStr}</a>\n                </dd>\n              </dl>\n            </Result> : null\n        }\n      </div>\n    )\n  }\n)\n\nexport default Component"]},"metadata":{},"sourceType":"module"}