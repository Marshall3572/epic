{"ast":null,"code":"import _objectSpread from\"/Users/marshall/Desktop/epic-react/epic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _taggedTemplateLiteral from\"/Users/marshall/Desktop/epic-react/epic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useRef}from'react';import{useStores}from'../stores';import{observer,useLocalStore}from'mobx-react';import{InboxOutlined}from'@ant-design/icons';import{Upload,message,Spin}from'antd';import styled from'styled-components';import image from'../stores/image';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Dragger=Upload.Dragger;var Result=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-top: 30px;\\n  border: 1px dashed #ccc;\\n  padding: 20px;\\n\"])));var H1=styled.h1(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin: 20px 0;\\n  text-align: center;\\n\"])));var Image=styled.img(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  max-width: 300px;\\n\"])));var Component=observer(function(){var _useStores=useStores(),ImageStore=_useStores.ImageStore,UserStore=_useStores.UserStore;var ref1=useRef(),ref2=useRef();// 返回值要加个括号，不然会被理解为函数体\nvar store=useLocalStore(function(){return{width:null,height:null,get widthStr(){return store.width?\"/w/\".concat(store.width):'';},get heightStr(){return store.height?\"/h/\".concat(store.height):'';},get fullStr(){return ImageStore.serverFile.attributes.url.attributes.url+'?imageView2/0'+store.widthStr+store.heightStr;},setHeight:function setHeight(height){store.height=height;},setWidth:function setWidth(width){store.width=width;}};});var bindWidthChange=function bindWidthChange(){store.setWidth(ref1.current.value);};var bindHeightChange=function bindHeightChange(){store.setHeight(ref2.current.value);};var props={showUploadList:false,beforeUpload:function beforeUpload(file){ImageStore.setFile(file);ImageStore.setFilename(file.name);if(UserStore.currentUser==null){message.warning('请先登陆再上传');return false;}// 可以在控制台看到文件的api\nwindow.file=file;// .ig是指忽略大小写\nif(!/(svg$)|(png$)|(jpg$)|(jpeg$)|(gif$)/ig.test(file.type)){message.error('只能上传.png/.gif/.jpg/.svg格式的图片');return false;}if(file.size>1024*1024){message.error('最大上传1M图片');return false;}ImageStore.upload().then(function(serverFile){console.log('上传成功');}).catch(function(){return console.log('上传失败');});return false;}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Spin,{tip:\"\\u4E0A\\u4F20\\u4E2D\",spinning:ImageStore.isUploading,children:/*#__PURE__*/_jsxs(Dragger,_objectSpread(_objectSpread({},props),{},{children:[/*#__PURE__*/_jsx(\"p\",{className:\"ant-upload-drag-icon\",children:/*#__PURE__*/_jsx(InboxOutlined,{})}),/*#__PURE__*/_jsx(\"p\",{className:\"ant-upload-text\",children:\"\\u70B9\\u51FB\\u6216\\u8005\\u62D6\\u62FD\\u4E0A\\u4F20\\u56FE\\u7247\"}),/*#__PURE__*/_jsx(\"p\",{className:\"ant-upload-hint\",children:\"\\u4EC5\\u652F\\u6301.png/.gif/.jpg/.svg\\u683C\\u5F0F\\u7684\\u56FE\\u7247\\uFF0C\\u56FE\\u7247\\u6700\\u59271M\"})]}))}),ImageStore.serverFile?/*#__PURE__*/_jsxs(Result,{children:[/*#__PURE__*/_jsx(H1,{children:\"\\u4E0A\\u4F20\\u7ED3\\u679C\"}),/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{children:\"\\u7EBF\\u4E0A\\u5730\\u5740\"}),/*#__PURE__*/_jsx(\"dd\",{children:/*#__PURE__*/_jsx(\"a\",{target:\"_blank\",href:ImageStore.serverFile.attributes.url.attributes.url,children:ImageStore.serverFile.attributes.url.attributes.url})}),/*#__PURE__*/_jsx(\"dt\",{children:\"\\u6587\\u4EF6\\u540D\"}),/*#__PURE__*/_jsx(\"dd\",{children:ImageStore.filename}),/*#__PURE__*/_jsx(\"dt\",{children:\"\\u56FE\\u7247\\u9884\\u89C8\"}),/*#__PURE__*/_jsx(\"dd\",{children:/*#__PURE__*/_jsx(Image,{src:ImageStore.serverFile.attributes.url.attributes.url})}),/*#__PURE__*/_jsx(\"dt\",{children:\"\\u66F4\\u591A\\u5C3A\\u5BF8\"}),/*#__PURE__*/_jsxs(\"dd\",{children:[/*#__PURE__*/_jsx(\"input\",{ref:ref1,onChange:bindWidthChange,placeholder:\"\\u6700\\u5927\\u5BBD\\u5EA6\\uFF08\\u53EF\\u9009\\uFF09\"}),/*#__PURE__*/_jsx(\"input\",{ref:ref2,onChange:bindHeightChange,placeholder:\"\\u6700\\u5927\\u9AD8\\u5EA6\\uFF08\\u53EF\\u9009\\uFF09\"})]}),/*#__PURE__*/_jsx(\"dd\",{children:/*#__PURE__*/_jsx(\"a\",{target:\"_blank\",href:store.fullStr,children:store.fullStr})})]})]}):null]});});export default Component;","map":{"version":3,"sources":["/Users/marshall/Desktop/epic-react/epic/src/components/Uploader.js"],"names":["React","useRef","useStores","observer","useLocalStore","InboxOutlined","Upload","message","Spin","styled","image","Dragger","Result","div","H1","h1","Image","img","Component","ImageStore","UserStore","ref1","ref2","store","width","height","widthStr","heightStr","fullStr","serverFile","attributes","url","setHeight","setWidth","bindWidthChange","current","value","bindHeightChange","props","showUploadList","beforeUpload","file","setFile","setFilename","name","currentUser","warning","window","test","type","error","size","upload","then","console","log","catch","isUploading","filename"],"mappings":"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","sourcesContent":["import React, {useRef} from 'react'\nimport {useStores} from '../stores'\nimport {observer, useLocalStore} from 'mobx-react'\nimport {InboxOutlined} from '@ant-design/icons'\nimport {Upload, message, Spin} from 'antd'\nimport styled from 'styled-components'\nimport image from '../stores/image'\n\nconst {Dragger} = Upload\n\nconst Result = styled.div`\n  margin-top: 30px;\n  border: 1px dashed #ccc;\n  padding: 20px;\n`\nconst H1 = styled.h1`\n  margin: 20px 0;\n  text-align: center;\n`\nconst Image = styled.img`\n  max-width: 300px;\n`\n\n\nconst Component = observer(() => {\n    const {ImageStore, UserStore} = useStores()\n    const ref1 = useRef(), ref2 = useRef()\n    // 返回值要加个括号，不然会被理解为函数体\n    const store = useLocalStore(() => ({\n      width: null,\n      height: null,\n      get widthStr() {\n        return store.width ? `/w/${store.width}` : ''\n      },\n      get heightStr() {\n        return store.height ? `/h/${store.height}` : ''\n      },\n      get fullStr() {\n        return ImageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr\n      },\n      setHeight(height) {\n        store.height = height\n      },\n      setWidth(width) {\n        store.width = width\n      },\n    }))\n\n    const bindWidthChange = () => {\n      store.setWidth(ref1.current.value)\n    }\n    const bindHeightChange = () => {\n      store.setHeight(ref2.current.value)\n    }\n    const props = {\n      showUploadList: false,\n      beforeUpload: file => {\n        ImageStore.setFile(file)\n        ImageStore.setFilename(file.name)\n        if (UserStore.currentUser == null) {\n          message.warning('请先登陆再上传')\n          return false\n        }\n        // 可以在控制台看到文件的api\n        window.file = file\n\n        // .ig是指忽略大小写\n        if (!/(svg$)|(png$)|(jpg$)|(jpeg$)|(gif$)/ig.test(file.type)) {\n          message.error('只能上传.png/.gif/.jpg/.svg格式的图片')\n          return false\n        }\n        if (file.size > 1024 * 1024) {\n          message.error('最大上传1M图片')\n          return false\n        }\n        ImageStore.upload()\n          .then((serverFile) => {\n              console.log('上传成功')\n            }\n          ).catch(() => console.log('上传失败'))\n        return false\n      }\n    }\n\n    return (\n      <div>\n        <Spin tip='上传中' spinning={ImageStore.isUploading}>\n          <Dragger {...props}>\n            <p className=\"ant-upload-drag-icon\">\n              <InboxOutlined/>\n            </p>\n            <p className=\"ant-upload-text\">点击或者拖拽上传图片</p>\n            <p className=\"ant-upload-hint\">\n              仅支持.png/.gif/.jpg/.svg格式的图片，图片最大1M\n            </p>\n          </Dragger>\n        </Spin>\n        {\n          ImageStore.serverFile ?\n            <Result>\n              <H1>上传结果</H1>\n              <dl>\n                <dt>线上地址</dt>\n                <dd><a target=\"_blank\"\n                       href={ImageStore.serverFile.attributes.url.attributes.url}>{ImageStore.serverFile.attributes.url.attributes.url}</a>\n                </dd>\n                <dt>文件名</dt>\n                <dd>{ImageStore.filename}</dd>\n                <dt>图片预览</dt>\n                <dd>\n                  <Image src={ImageStore.serverFile.attributes.url.attributes.url}/>\n                </dd>\n                <dt>更多尺寸</dt>\n                <dd>\n                  <input ref={ref1} onChange={bindWidthChange} placeholder=\"最大宽度（可选）\"/>\n                  <input ref={ref2} onChange={bindHeightChange} placeholder=\"最大高度（可选）\"/>\n                </dd>\n                <dd>\n                  <a target=\"_blank\" href={store.fullStr}>{store.fullStr}</a>\n                </dd>\n              </dl>\n            </Result> : null\n        }\n      </div>\n    )\n  }\n)\n\nexport default Component"]},"metadata":{},"sourceType":"module"}